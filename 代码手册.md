# CRP代码手册
###### by dzknb vision 1.0

---

## 简介
- crp是一个解释型语言，由python实现，风格偏向汇编语言，力求代码简洁。
- crp是一个实验性的作品，其运行效率和复杂度不适合开发大型项目。

---

## 编写手册 

### 数据类型
- crp支持以下数据类型（均以标志符区分，不做其他校验）

| 类型 | 代号 | 形式 |
| ---- | --- | --- |
|变量  |   `Type:Value`  |  `_value`    |       
|字符串|  `Type:String` |  `"string"`|
|数字|  `Type:Int` |     `'123456'` |
|小数（浮点数）|   `Type:Float`| `<1.2345>`| 
|标签|`Type:Label`|`~label`|
|列表|`Type:List`|`{xx;xx;xx}`|
|包|    | `*math`|
|功能|      | `#out`|
|空|`Type:None`|    |

- 数据类型的转换使用[`typ`](#typ)命令

### 转移符
- crp的转译符仅在输入/输出阶段处理，运行中当作正常字符串处理
- crp使用空格作为分隔符，若不想作为分隔，请使用`^s`

| 转译符| 转译后|
| --- | --- |
|`^s`|` `（空格）|
|`^n`|` `(换行)|
|`^d`|`;`|

### 命令列表
- crp命令类似汇编语言，格式相似
- 一般情况下逐行执行命令，换行或注释忽略

|命令格式|说明|
|--------------------------------------|-------------|
|[new](#new) <变量> ... <变量>                 |创建变量|
|[mov](#mov) <变量> <值>                       |复制|
|[add](#add) <变量> <值>                       |加法|
|[sub](#sub) <变量> <值>                       |减法|
|[mul](#mul) <变量> <值>                       |乘法|
|[div](#div) <变量> <值>                       |除法|
|[cal](#cal) <返回变量> <功能> <参数> ... <参数> |调用内置功能|
|[got](#got) <标签> <参数>                     |跳转标签|
|rpy <返回变量> <命令>                  |运行python代码|
|[psh](#psh) <变量> <值>                       |列表加入元素|
|[pop](#pop) <变量> <索引>                     |列表删除元素|
|[idx](#pop) <返回值/变量> <索引>               |列表获取元素|
|[cmp](#cmp) <值> <值>                        |比较是否相同（若相同则执行下一行，否则跳过下一行）|
|[ifb](#ifb) <值> <值>                        |比较是否大于（若大于则执行下一行，否则跳过下一行）|
|[ifs](#ifs) <值> <值>                        |比较是否小于（若小于则执行下一行，否则跳过下一行）|
|[typ](#typ) <变量> <类型>                     |强制类型转换|
|[imp](#imp) <包>                             |导入包|
|[put](#put) <错误>			|发生错误|
|[err](#err) <标签>                           |指定错误跳转标签|

- <值>可以为立即数也可是变量

### 非命令

#### 注释
- `;`为注释符号，注释仅能在行开头生效，且为单行注释
- 注释行不会运行，可以不使用转译符

#### 标签
- 当行开头为`~`时，表示定义标签
- 标签记录了当前位置，后续被[`got`](#got)，[`err`](#err)命令跳转到该位置

### 单条命令解释

#### new
用于创建变量
```
new <变量名> ... <变量名>
```
- 可连续创建变量，但是不可重复创建 
- 创建的变量默认类型为`Type:None`
- 该命令为预处理命令，所有变量均为全局

#### mov
用于变量赋值
```
mov <变量> <值>
```
- 赋值会改变<变量>的类型
- 赋值需要<变量>存在

#### 运算符

##### add
用于变量之间或变量和立即数之间加法
```
add <变量> <值>
```
- 加法后的结果将存入<变量>
- <变量>和<值>的类型需要一致
- 若类型为`Type:String`则为字符串相连

##### sub
用于变量之间或变量和立即数之间减法
```
sub <变量> <值>
```
- 减法后的结果将存入<变量>
- <变量>和<值>的类型需要一致

##### mul
用于变量之间或变量和立即数之间乘法
```
mul <变量> <值>
```
- 乘法后的结果将存入<变量>

##### div
用于变量之间或变量和立即数之间除法
```
div <变量> <值>
```
- 除法后的结果将存入<变量>
- 除法后的结果为`Type:Float`
- <值>不能为`'0'`

#### cal
用于调用内置功能
```
cal <返回变量> <命令> (<参数> ... <参数>)
```
- <返回变量>必须存在 

|返回值|命令|参数|功能|
| --- | --- | ----- | --- |
|     | #out| <输出值>| 输出<输出值>|
|<输入内容>|#in|   |获取输入|
|<类型>|#type|<值>|获取<值>数据类型|
|<处理后值>|#range|<值> <起始索引> <末尾索引>|从<值>中截取部分|
|<长度>|#len|<值>|获取<值>的长度|

#### 分支语句

##### got
用于跳转到指定标签
```
got <标签> (<静默跳转[False]>)
```
- <标签>必须存在
- 当存在`False`参数时，本次跳转将不记录位置
- 当<标签>为`~`时，将跳转回有记录的上次跳转点

##### cmp
用于比较并根据结果决定是否执行下一行
```
cmp <值1> <值2>
<命令1>
<命令2>
```
- <值1>和<值2>必须存在
- 比较内容包括二者的类型和值
- 当相同时，会执行<命令1>，否则跳过<命令1>，执行<命令2>
- 当执行<命令1>后由于命令逐行执行，<命令2>也会执行

##### ifs
用于比较小于并根据结果决定是否执行下一行
```
ifs <值1> <值2>
<命令1>
<命令2>
```
- <值1>和<值2>必须存在
- 二者类型必须相同
- 当相同时，会执行<命令1>，否则跳过<命令1>，执行<命令2>
- 当执行<命令1>后由于命令逐行执行，<命令2>也会执行

##### ifb
用于比较大于并根据结果决定是否执行下一行
```
ifb <值1> <值2>
<命令1>
<命令2>
```
- <值1>和<值2>必须存在
- 二者类型必须相同
- 当相同时，会执行<命令1>，否则跳过<命令1>，执行<命令2>
- 当执行<命令1>后由于命令逐行执行，<命令2>也会执行

#### 错误处理

##### put
用于提出一个错误
```
put <错误>
```
- 提出错误与运行错误处理逻辑相同

##### err
用于指定错误处理标签
```
err <标签>
```
- <标签>必须存在
- 当发生错误时且指定了错误处理标签，会跳转到<标签>，错误内容保存在`_Error`
- 该命令非预处理命令，后续指定会覆盖先前的指定

##### 列表操作

###### pop
用于从列表中删除指定元素
```
pop <变量> <索引>
```
- <变量>必须存在且类型为`Type:List`
- <索引>类型为`Type:Int`且不能超出范围

###### psh
用于从列表中加入指定元素
```
psh <变量> <值>
```
- <变量>必须存在且类型为`Type:List`
- <值>将加在<变量>末尾

###### idx
用于从列表中获取指定元素
```
idx <变量> <索引>
```
- <变量>必须存在且类型为`Type:List`
- <索引>类型为`Type:Int`且不能超出范围
- 获取的元素将存入<变量>

#### typ 
用于类型转换
```
typ <变量> <类型>
```
- <变量>必须存在
- <类型>不能为`Type:Value,Type:Label`
- <变量>必须可以被转换为指定类型

#### imp
用于导入包
```
imp <包>
```
- 导入包相当于将包文件内容复制到代码中

- [包手册](#包手册)

### 代码结构

#### 循环
- crp没有专门的循环命令，使用分支+调转代替
```
;执行10次
new _count
mov _count '0' 
~loop
<循环>
add _count '1'
ifs _count '10'
got ~loop
<后续>
```
#### 函数
- crp没有专门定义函数和调用函数，使用跳转+赋值代替
```
;定义函数f(f_a,f_b): return(f_a+f_b)
new _f_a _f_b _f_return
~f
add _f_a _f_b
mov _f_return _f_a
got ~

;调用f(1,2)并输出返回值
mov _f_a '1'
mov _f_b '2'
got ~f
cal _None #out _f_return
```
- 因为crp所有变量和标签均为全局，因此私有变量和私有标签应该加入所属名以便区分

---

## 包手册
- 包是crp一个重要部分，包可以被[imp](#imp)导入，通过包可以实现很多功能

- 目前的包有以下几个

|包文件|包名|功能|
| --- | --- | --- |
|math.imp|[*math](#math包)|高级数学运算|
|gui.imp|[*gui](#gui包)|gui操作（tkinter）|
|string.imp|[*string](#string包)|字符串操作|

### 包的调用
```
;调用*math中的功能标签 ~math_abs，参数：'-5'，输出返回值
;~math_abs 的参数: _math_abs_argu ，返回变量：_math_abs_return
imp *math
mov _math_abs_argu '-5'
got ~math_abs
cal _None #out _math_abs_return
```

### 自带包

#### math包
- 用于高级数学运算

|功能标签 | 参数 | 返回值|功能|
| --- | --- | -- | --- |
| `~math_abs`| `_math_abs_argu`|`_math_abs_return`|绝对值|
| `~math_sqrt`|`_math_sqrt_argu`|`_math_sqrt_return`|平方根|



#### gui包


#### string包